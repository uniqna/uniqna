{% extends "base/base.html" %} {% load staticfiles %} {% load timesince_upto %} {% load bleach_tags %} {% block meta %}
<meta name="description" content="{{question.description|truncatechars:100}} Answers: {{question.answers}}">
<meta name="author" content="{{question.author}}">
<meta name="theme-color" content="#3F51B5 "> {% endblock meta %} {% block titlename %} {{ question.title }} - uniqna {% endblock titlename %} {% block head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/highlight.js/latest/styles/github.min.css">
<link rel="stylesheet" href="{% static 'css/notyf.min.css' %}">
<link rel="stylesheet" href="{% static 'css/threads/threads.css' %}">
<link rel="stylesheet" href="{% static 'css/base/search.css' %}"> {% endblock head %} {% block content %} {% include 'home_templates/search.html' %}
<!-- The question and answers -->
<center>
  {% if question.solved == False %}
  <div class="question_title mdl-cell mdl-cell--12-col">
    {{ question.title }}
  </div>
  {% else %}
  <div class="question_title_solved mdl-cell mdl-cell--12-col">
    {{ question.title }}
  </div>
  {% endif %}

  <div class="question_meta mdl-cell mdl-cell--12-col">
    <p> {% if question.metatype == "question" %}Asked{% else %}Submitted{% endif %} on {{ question.created_time|date:"d M, Y" }} by <a href="{% url 'user' question.author %}" class="question_meta">{{ question.author }}</a> </p>
  </div>
  {% if question.tags.all %}
  <div class="question_meta_tags mdl-cell mdl-cell--12-col">
    {% for t in question.tags.all %}
    <a href="{% url 'tags' t.name %}">#{{t.name}}</a> {% endfor %} &nbsp
  </div>
  {% endif %}
      <!--
      <div class="question_meta_answers mdl-cell mdl-cell--12-col">
      {{ question.views}}
    </div>
    -->
</center>

{% if question.author == request.user.username %}
<center><a class="question_delete" href="{% url 'delete_question' question.pk %}">Delete?</a></center>
{% if question.metatype == "question" and question.solved == False %}
<center><a class="question_solved" href="{% url 'mark_answer_solved' question.pk %}">Mark as Solved?</a></center>
{% endif %} {% endif %}

<div class="question_description_parent mdl-cell mdl-cell--10-col">
  <div class="question_description mdl-cell mdl-cell--10-col">
    {{ description|bleach }}
  </div>
</div>

<div class="mdl-cell mdl-cell--12-col">
  <div class="mdl-cell mdl-cell--2-col voting">
    <div class="mdl-grid voting">
      <div class="mdl-cell mdl-cell--1-col votesu">
        <button data-url="{% url 'question_vote' question.pk 'u' %}" class="mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect upvote snackbar_show" data-id="{{question.pk}}">
          <i class="material-icons votecolor {% if request.user in question.ups.all %} vote-success {% else %} vote-default {% endif %}" id="up{{ question.pk }}">expand_less</i>
        </button> {% if user.is_anonymous %}
        <script>
        var anonFlag = 1;
        </script>
        <div id="snackbar_reveals" class="mdl-js-snackbar mdl-snackbar">
          <div class="mdl-snackbar__text"></div>
          <button class="mdl-snackbar__action" type="button"></button>
        </div>
        {% endif %}
      </div>
      <div class="mdl-cell mdl-cell--1-col score" id="score{{question.pk}}">
        <center>{{ question.points }}</center>
      </div>
      <div class="mdl-cell mdl-cell--1-col votesd">
        <button data-url="{% url 'question_vote' question.pk 'd' %}" class="mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect downvote mdl-snackbar__action snackbar_show" data-id="{{question.pk}}">
          <i class="material-icons votecolor {% if request.user in question.downs.all %} vote-danger {% else %} vote-default {% endif %}" id="down{{question.pk}}">expand_more</i>
        </button>
      </div>
    </div>
  </div>
</div>

<center>
  <div class="can_you_help">
    {% if user.is_anonymous %}
    <p>Please <a href="{% url 'home' %}" style="color:#3f51b5">login</a> to contribute to this discussion!
      <p>
        {% elif question.metatype == "question" %}
        <p>Can you help? This forum depends on everyone sharing their knowledge. If you're able to answer this question, please do!</p>
        {% else %}
        <p>This forum depends on everyone sharing their ideas. If you're able to contribute to this discussion, please do!</p>
        {% endif %}
      </div>
    </center>

    {% if user.is_authenticated %}
    <script>
    var anonFlag = 0;
    </script>
    <div class="writeanswer">
      <form action="answer/" method="post">
        <div class="mdl-cell mdl-cell--10-col mdl-cell--1-offset-desktop mdl-cell--4-col-phone">
          {{ form.description }} {% csrf_token %}
        </div>
        <center>
          <div class="ask1">
            <input type="submit" name="submit" class="submit" value="">
            <button class="ask mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect" id="submitdummy" value="Ask">
              <i class="ask_icon material-icons">send</i>
            </button>
          </div>
        </center>
      </form>
    </div>
    <br> {% endif %}
    <br> {% load bleach_tags %}

    <!-- Answers -->

    {% load mptt_tags %} {% recursetree nodes %}
    <div class="mdl-cell mdl-cell--12-col answercontainer" id="a{{node.pk}}">
      <div class="mdl-grid platform answer_parent">

        <div class="answer_voting_parent mdl-cell mdl-cell--1-col" id="voteparent{{node.id}}">
          <div class="mdl-grid voting-align">
            <div class="mdl-cell mdl-cell--1-col voting_align answer_vote_size">
              <button data-url="{% url 'answer_vote' node.pk 'u' %}" class="mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect ansUpvote snackbar_show" data-id="{{node.pk}}">
                <i class="material-icons votecolor {% if request.user in node.ups.all %} vote-success {% else %} vote-default {% endif %} ansUp{{ node.pk }}">expand_less</i>
              </button>
            </div>
            <div class="mdl-cell mdl-cell--1-col score answer_score_size">
              <center class="ansScore{{node.pk}}">{{ node.points }}</center>
            </div>
            <div class="mdl-cell mdl-cell--1-col voting_align answer_vote_size">
              <button data-url="{% url 'answer_vote' node.pk 'd' %}" class="mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect ansDownvote snackbar_show" data-id="{{node.pk}}">
                <i class="material-icons votecolor{% if request.user in node.downs.all %} vote-danger {% else %} vote-default {% endif %} ansDown{{node.pk}}">expand_more</i>
              </button>
            </div>
          </div>
        </div>

        <div class="answer">

          <div class="mdl-cell mdl-cell--5-col answer_author_meta">
            <div class="minimise" data-id="{{node.id}}"><a>[-]</a></div>
            @<a href="{% url 'user' node.answer_author %}" class="userlinks">{{ node.answer_author }}</a>
            <a class="answer_meta_time">{{ node.created_time|timesince|upto:"," }} ago{% if node.edited %}*{% endif %}</a>
            <a id="clipboard_{{ node.pk }}" class="clipboard_button" data-clipboard-text="https://uniqna.com{% url 'thread' question.pk %}#a{{node.pk}}" data-id="{{node.pk}}">
              <i class="material-icons link_clipboard">link</i>
            </a>
            <div class="mdl-tooltip" for="clipboard_{{ node.pk }}">
              <span id="aspan{{node.pk}}">Permalink</span>
            </div>
          </div>

          <br>

          <div class="answer_description" id="answerdesc{{node.id}}">
            <div class="answer_description_align {% if node.is_leaf_node %} leaf-node {% endif %}">{{ node.description|bleach }}
              {% if node.edited == True%}<br>{% endif %} {% if node.answer_author == request.user.username %}
              <div class="meta_parent">
                <div class="answer_user">
                  <a class="question_delete" href="{% url 'delete_answer' question.pk node.pk %}" class="btn btn-danger">Delete</a> |
                  <a style="color: #757575; " href="{% url 'edit_answer' question.pk node.pk %}" class="btn btn-success">Edit</a>
                </div>
              </div>
              {% endif %}
              <div class="reply"><a>Reply</a></div>
              <div class="childVoteParent" id="childVoteParent{{node.id}}">
                <button data-url="{% url 'answer_vote' node.pk 'u' %}" class="mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect ansUpvote snackbar_show" data-id="{{node.pk}}">
                <i class="material-icons votecolor {% if request.user in node.ups.all %} vote-success {% else %} vote-default {% endif %} ansUp{{ node.pk }}">expand_less</i>
              </button>
                <div class="child-score ansScore{{node.pk}}"><center class="ansScore{{node.pk}}">{{ node.points }}</center></div>
                <button data-url="{% url 'answer_vote' node.pk 'd' %}" class="mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect ansDownvote snackbar_show" data-id="{{node.pk}}">
                <i class="material-icons votecolor{% if request.user in node.downs.all %} vote-danger {% else %} vote-default {% endif %} ansDown{{node.pk}}">expand_more</i>
              </button>
              </div>
              <script> var reply_anon_flag = 1; </script>
              {% if user.is_authenticated %}
              <script> var reply_anon_flag = 0; </script>
              <div class="reply-container">
                <form action="{% url 'submitreply' node.id %}" method="POST" class="reply-form" id="reply-form{{node.id}}">
                  {% csrf_token %}
                  <textarea class="textarea-reply" placeholder="Be nice and Markdown is supported :)" name="description" id="id_description"></textarea>
                  <div class="reply-submit">
                    <button type="submit" class="mdl-button mdl-js-button mdl-button--icon submit-reply" data-id="{{ node.id }}">
                      <i class="material-icons">send</i>
                    </button>
                  </div>
                </form>
              </div>
              {% endif %}
            </div>

            {% if not node.is_leaf_node %}
            <div class="answer_description reply_parent" data-url="{% url 'reply' node.question.id node.id%}">
              <div class="answer_description_align child"> {{ children }}
              </div>
            </div>
            {% endif %}
          </div>

        </div>
      </div>
    </div>
    {% endrecursetree %} {% endblock content %}

    {% block js %}
    <script src='{% static "js/notyf.js" %}'></script>
    <script src="https://cdn.jsdelivr.net/highlight.js/latest/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
    <script src='{% static "js/clipboard.min.js" %}'></script>
    <script src='{% static "js/threads/thread.js" %}'></script>
    {% endblock js %}
